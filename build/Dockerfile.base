######################
# Dependencies image #
######################
FROM golang:1.21-alpine as builder

RUN apk --update-cache add curl
ARG TARGETARCH=amd64
RUN [[ "${TARGETARCH}" == "amd64" ]] && apk add upx || true

# Setup build directory
RUN mkdir -p /build
WORKDIR /build

# Fetch deps first as they don't change frequently
COPY go.mod /build/go.mod
COPY go.sum /build/go.sum
RUN go mod download